{% extends "base.html" %}

{% block title %}Admin Settings - CNU Dental Clinic Scheduler{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">System Settings</h2>
    </div>
    
    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-paint-brush me-2"></i>Schedule UI Customization</h5>
            </div>
            <div class="card-body">
                <div class="mb-3 text-muted">Choose colors used across schedule views and exports.</div>
                <div class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label for="amColor" class="form-label">AM Row Color</label>
                        <input type="color" class="form-control form-control-color" id="amColor" value="#cce5ff">
                        <div class="form-text">Applied to morning rows</div>
                    </div>
                    <div class="col-md-6">
                        <label for="pmColor" class="form-label">PM Row Color</label>
                        <input type="color" class="form-control form-control-color" id="pmColor" value="#fff2cc">
                        <div class="form-text">Applied to afternoon rows</div>
                    </div>
                    <div class="col-md-6">
                        <label for="headerBgColor" class="form-label">Header Background</label>
                        <input type="color" class="form-control form-control-color" id="headerBgColor" value="#212529">
                        <div class="form-text">Used for weekday headers</div>
                    </div>
                    <div class="col-md-6">
                        <label for="headerTextColor" class="form-label">Header Text Color</label>
                        <input type="color" class="form-control form-control-color" id="headerTextColor" value="#ffffff">
                        <div class="form-text">Text color for headers</div>
                    </div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="saveSettings()"><i class="fas fa-save me-2"></i>Save Settings</button>
                    <button class="btn btn-outline-secondary ms-2" onclick="resetSettings()"><i class="fas fa-undo me-2"></i>Reset</button>
                    <span id="saveMsg" class="ms-3 text-success" style="display:none;">Saved</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Live Preview</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th style="width:140px">Chair / Time</th>
                                <th>Monday</th>
                                <th>Tuesday</th>
                                <th>Wednesday</th>
                                <th>Thursday</th>
                                <th>Friday</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="am-row">
                                <td><strong>Chair 1</strong><br><small>8:00-9:20</small></td>
                                <td>Exam</td>
                                <td>Filling</td>
                                <td>-</td>
                                <td>-</td>
                                <td>Crown</td>
                            </tr>
                            <tr class="pm-row">
                                <td><strong>Chair 1</strong><br><small>13:00-14:20</small></td>
                                <td>-</td>
                                <td>Root Canal</td>
                                <td>-</td>
                                <td>Extraction</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="text-muted mt-2">Preview updates immediately after saving.</div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadSettings();
    applyStyles();
    // Live update on input
    const ids = ['amColor','pmColor','headerBgColor','headerTextColor'];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', saveSettings);
    });
});

function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
}

function setCookie(name, value, days) {
    let expires = '';
    if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = `; expires=${date.toUTCString()}`;
    }
    document.cookie = `${name}=${value || ''}${expires}; path=/`;
}

function loadSettings() {
    document.getElementById('amColor').value = getCookie('amColor') || '#cce5ff';
    document.getElementById('pmColor').value = getCookie('pmColor') || '#fff2cc';
    document.getElementById('headerBgColor').value = getCookie('headerBgColor') || '#212529';
    document.getElementById('headerTextColor').value = getCookie('headerTextColor') || '#ffffff';
}

function saveSettings() {
    const amColor = document.getElementById('amColor').value;
    const pmColor = document.getElementById('pmColor').value;
    const headerBgColor = document.getElementById('headerBgColor').value;
    const headerTextColor = document.getElementById('headerTextColor').value;

    setCookie('amColor', amColor, 365);
    setCookie('pmColor', pmColor, 365);
    setCookie('headerBgColor', headerBgColor, 365);
    setCookie('headerTextColor', headerTextColor, 365);

    applyStyles();
    const msg = document.getElementById('saveMsg');
    msg.style.display = 'inline';
    setTimeout(() => { msg.style.display = 'none'; }, 1500);
}

function resetSettings() {
    setCookie('amColor', '', -1);
    setCookie('pmColor', '', -1);
    setCookie('headerBgColor', '', -1);
    setCookie('headerTextColor', '', -1);
    location.reload();
}

function applyStyles() {
    const amColor = getCookie('amColor') || '#cce5ff';
    const pmColor = getCookie('pmColor') || '#fff2cc';
    const headerBgColor = getCookie('headerBgColor') || '#212529';
    const headerTextColor = getCookie('headerTextColor') || '#ffffff';

    let style = document.getElementById('custom-ui-styles');
    if (!style) {
        style = document.createElement('style');
        style.id = 'custom-ui-styles';
        document.head.appendChild(style);
    }
    style.textContent = `
        .am-row, .am-row > td { background-color: ${amColor} !important; }
        .pm-row, .pm-row > td { background-color: ${pmColor} !important; }
        .table-dark, .table-dark th { background-color: ${headerBgColor} !important; color: ${headerTextColor} !important; }
        .table-dark thead th { color: ${headerTextColor} !important; }
    `;
}
</script>
{% endblock %}